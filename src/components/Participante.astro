---
import { getDatabaseItems } from '../lib/notion';
import type { User } from '../lib/user.model.ts';
import Woman from '../assets/woman.png';
import Man from '../assets/man.png';

const users = await getDatabaseItems();

// FunciÃ³n para obtener el texto de un tÃ­tulo de Notion
function getTitleText(titleArray: any[]): string {
	if (!titleArray || titleArray.length === 0) return 'Sin nombre';
	return titleArray[0]?.plain_text || titleArray[0]?.text?.content || 'Sin nombre';
}

// FunciÃ³n para obtener el nombre de un select
function getSelectName(select: any): string {
	return select?.name || 'N/A';
}

// FunciÃ³n para obtener el nombre de un status
function getStatusName(status: any): string {
	return status?.name || 'N/A';
}

// FunciÃ³n para obtener la imagen segÃºn el sexo
function getGenderImage(sexo: string) {
	const sexoLower = sexo.toLowerCase();
	if (sexoLower === 'mujer' || sexoLower === 'femenino' || sexoLower === 'f') {
		return Woman;
	} else if (sexoLower === 'hombre' || sexoLower === 'masculino' || sexoLower === 'm') {
		return Man;
	}
	return Man; // Por defecto
}
---

<div class="min-h-screen bg-gradient-to-b from-blue-900 via-purple-900 to-black py-16 px-4 md:px-8">
	<div class="max-w-7xl mx-auto">
		<!-- Header -->
		<div class="text-center mb-12">
			<h1 class="text-4xl md:text-5xl font-bold text-white mb-4">
				ğŸš€ Participantes de Stellar ğŸš€
			</h1>
			<p class="text-xl text-yellow-400">
				Total de astronautas: {users.length}
			</p>
		</div>

		<!-- Lista de participantes -->
		{users.length > 0 ? (
			<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
				{users.map((user: User) => {
					const sexo = getSelectName(user.Sexo.select);
					const genderImage = getGenderImage(sexo);
					
					return (
					<div class="bg-gradient-to-br from-blue-600/20 to-purple-700/20 backdrop-blur-lg border-2 border-yellow-400/50 rounded-xl p-6 hover:border-yellow-400 hover:shadow-[0_0_30px_rgba(251,191,36,0.3)] transition-all duration-300">
						<!-- Imagen de perfil segÃºn sexo -->
						<div class="flex justify-center mb-4">
							<div class="w-24 h-24 rounded-full overflow-hidden border-4 border-yellow-400/60 shadow-lg">
								<img src={genderImage.src} alt={sexo} class="w-full h-full object-cover" />
							</div>
						</div>
						
						<!-- Nombre -->
						<div class="text-center">
							<h3 class="text-lg md:text-xl font-bold text-white leading-tight break-words px-2">
								{getTitleText(user.Nombre.title)}
							</h3>
						</div>
					</div>
					);
				})}
			</div>
		) : (
			<div class="text-center py-20">
				<div class="text-6xl mb-4">ğŸ”</div>
				<p class="text-2xl text-white">No hay participantes registrados aÃºn</p>
				<p class="text-gray-400 mt-2">Los astronautas aparecerÃ¡n aquÃ­ cuando se registren</p>
			</div>
		)}

		<!-- CTA Section -->
		<div class="mt-16 text-center bg-gradient-to-r from-yellow-400 via-orange-400 to-red-500 rounded-2xl p-8 md:p-12 shadow-2xl">
			<div class="text-5xl md:text-6xl mb-6">ğŸš€âœ¨</div>
			<h2 class="text-3xl md:text-4xl font-bold text-black mb-4">
				Â¿Quieres ser parte de esta gran aventura?
			</h2>
			<p class="text-lg md:text-xl text-gray-800 mb-8">
				Â¡Ãšnete a nuestra tripulaciÃ³n espacial y vive una experiencia inolvidable!
			</p>
			<a href="/" class="inline-block bg-black hover:bg-gray-900 text-yellow-400 font-bold py-4 px-8 md:px-12 rounded-full text-lg md:text-xl transition-all transform hover:scale-105 shadow-2xl">
				ğŸŒŸ Â¡InscrÃ­bete Ahora!
			</a>
		</div>
	</div>
</div>

<style>
	@keyframes fadeIn {
		from {
			opacity: 0;
			transform: translateY(20px);
		}
		to {
			opacity: 1;
			transform: translateY(0);
		}
	}
</style>